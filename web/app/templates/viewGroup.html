{% extends "base.html" %}

{% set logged = True %}
{% set therapistName = therapistLiteral %}

<!-- Import macros -->

{% from 'macros.html' import titleMacro with context %}
{% from 'macros.html' import patternsTableMacro with context %}
{% from 'macros.html' import patientsTableMacro with context %}
{% from 'macros.html' import breadCrumbMacro with context %}

{% block head %}

    {% assets "accordionMultiselectCss" %}
        <link rel="stylesheet" href="{{ ASSET_URL }}" type="text/css" />
    {% endassets %}

    {% assets "accordionMultiselectJs" %}
        <script type="text/javascript" src="{{ ASSET_URL }}"></script>
    {% endassets %}

    <script type="text/javascript" charset="utf-8">
        $(document).ready(function() {
            $(function () {
                $('#paginationSelect').multipleSelect();
                $('#paginationSelect2').multipleSelect();
            })
        });
    </script>

    <!-- SocketIO methods -->
    <script>
        namespace = '/viewGroup';
        var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

        function paginationFunc(){
            socket.emit('paginationPattern', {"idGroup": {{ idGroup }}, "patternPage": document.getElementById("paginationSelect").value});
        }

        function paginationFunc2(){
            socket.emit('paginationPattern', {"idGroup": {{ idGroup }}, "patientPage": document.getElementById("paginationSelect2").value});
        }

        function newPattern(){
            location.href = location.protocol + '//' + location.host + "/registrarPautaGrupo/" + {{idGroup}};
        }

        function linkPattern(){
            location.href = location.protocol + '//' + location.host + "/enlazarPautasGrupo/"+{{idGroup}};
        }

        function unlinkPattern(pattId){
            location.href = location.protocol + '//' + location.host + "/verGrupo/"+{{idGroup}} + "?unlinkPatt=" + pattId;
        }


        socket.on('paginationPattern', function(message) {

            var bodyContent = "";

            //No registers, but also no errors
            if(message.body == ""){
                $("#tablePatterns tbody").html("");
            }else {
                var rows = message.body.split(";");

                for(i=0; i<rows.length; i++){
                    var cols = rows[i].split(",");

                    bodyContent += "<tr>"
                    
                    //Name
                    bodyContent += "<td>"+cols[1]+"</td>"
                    //Surname1
                    bodyContent += "<td>"+cols[2]+"</td>"
                    //Surname2
                    bodyContent += "<td>"+cols[3]+"</td>"
                    //Gender
                    var gender = cols[4] == "M" ? "<i class='fas fa-mars'></i> &nbsp; Masculino" : "<i class='fas fa-venus'></i> &nbsp; Femenino";
                    //mars
                    bodyContent += "<td>"+gender+"</td>"
                    //Age
                    bodyContent += "<td>"+cols[5]+"</td>"
                    //View pattern
                    bodyContent += "<td><a href=/verPaciente/"+ cols[0] +"} target=\"_blank\"><i class='fas fa-eye'></i> &nbsp; Ver </a> </td>"
                    
                    bodyContent += "</tr>"
                }
            }

            $("#tablePatterns tbody").html(bodyContent);
        });

        socket.on('paginationPattern', function(message) {

            var bodyContent = "";

            //No registers, but also no errors
            if(message.body == ""){
                $("#tablePatterns tbody").html("");
            }else {
                var rows = message.body.split(";");

                for(i=0; i<rows.length; i++){
                    var cols = rows[i].split(",");

                    bodyContent += "<tr>"
                    
                    //Name
                    bodyContent += "<td>"+cols[1]+"</td>"
                    //Intensity1
                    var intensity1 = cols[2] == "No" ? "<span style='color:red;'><i class='fas fa-times'></i></span>" : "<span style='color:green;'><i class='fas fa-check'></i></span>";
                    bodyContent += "<td>"+ intensity1 +"</td>"
                    //Intensity2
                    var intensity2 = cols[3] == "No" ? "<span style='color:red;'><i class='fas fa-times'></i></span>" : "<span style='color:green;'><i class='fas fa-check'></i></span>";
                    bodyContent += "<td>"+ intensity2 +"</td>"
                    //Intensity3
                    var intensity3 = cols[4] == "No" ? "<span style='color:red;'><i class='fas fa-times'></i></span>" : "<span style='color:green;'><i class='fas fa-check'></i></span>";
                    bodyContent += "<td>"+ intensity3 +"</td>"
                    //View pattern
                    bodyContent += "<td><a href=/verPauta/"+ cols[0] +"} target=\"_blank\"><i class='fas fa-eye'></i> &nbsp; Ver </a> </td>"
                    
                    bodyContent += "</tr>"
                }
            }

            $("#tablePatterns tbody").html(bodyContent);
        });
    </script>    

{% endblock %}

{% block content %}

{{ breadCrumbMacro(rowsBreadCrumb, "Ver un grupo de pautas") }}

<!-- Title -->
{{ titleMacro("Ver un grupo de pautas") }}

<!-- Input data -->

<div class="columns is-vcentered is-centered">

    <div class="column is-8 box" align="center">
        <h4 class="title is-4">Datos del grupo de pautas</h4>
        <b> Nombre</b>:&nbsp;&nbsp; {{ groupInfo.name }}
        <br><br>
        <b> Descripción </b>:&nbsp;&nbsp; {{ groupInfo.description }}

        <br><br>

        <a href=/editarGrupo/{{ groupInfo.id }}><input class="button is-primary" type="button" value="Modificar"></a>

        <div style='max-width:400px'><hr></div>

        <div class="box" style='max-width:1000px'>
            <h4 class="title is-4 is-spaced">Pautas incluidas en este grupo</h4>

            {% if rowsPatterns|length > 0 %}
                {{ patternsTableMacro(rowsPatterns, 0, 1) }}
            {% endif %}

            Número de registros totales: <b>{{ numberRowsPattern }}</b>
            {% if pagesPatterns > 1 %}
                <br>
                {{ form.pagination.label }} &nbsp;&nbsp; {{ form.pagination }}
            {% endif %}

            <br><br>

            <input class="button is-link" id="linkPatternBtn" name="linkPatternBtn" onclick="javascript:newPattern()" type="button" value="Registrar una nueva pauta">
            <input class="button is-info" id="linkPatternBtn" name="linkPatternBtn" onclick="javascript:linkPattern()" type="button" value="Enlazar una nueva pauta">
        </div>

    </div>

</div>

{% endblock %}